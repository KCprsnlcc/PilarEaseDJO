<!-- itrc_tools/templates/itrc_tools/reports.html -->

{% extends "itrc_tools/base_itrc.html" %} {% block itrc_content %}
<div class="pilarease-itrc-reports-container animate__animated animate__fadeIn">
  <h1 class="pilarease-itrc-section-title">Reports & Analytics</h1>

  <!-- User Activity Metrics -->
  <h2 class="pilarease-itrc-subsection-title">1. User Activity Metrics</h2>

  <!-- Login Activity Analysis -->
  <div class="pilarease-itrc-chart-container">
    <h3>Login Activity Over the Last 30 Days</h3>
    <canvas id="loginActivityChart"></canvas>
  </div>

  <!-- Daily Active Users (DAU) -->
  <div class="pilarease-itrc-chart-container">
    <h3>Daily Active Users (DAU) Over the Last 30 Days</h3>
    <canvas id="dauChart"></canvas>
  </div>

  <!-- User Registration Trends -->
  <div class="pilarease-itrc-chart-container">
    <h3>User Registrations Over the Last 30 Days</h3>
    <canvas id="userRegistrationChart"></canvas>
  </div>

  <!-- User Demographic Insights -->
  <h2 class="pilarease-itrc-subsection-title">2. User Demographic Insights</h2>

  <!-- User Role Distribution -->
  <div class="pilarease-itrc-chart-container">
    <h3>User Role Distribution</h3>
    <canvas id="userRoleChart"></canvas>
  </div>

  <!-- User Verification Status -->
  <div class="pilarease-itrc-chart-container">
    <h3>User Verification Status</h3>
    <canvas id="userVerificationChart"></canvas>
  </div>

  <!-- Data Volume Metrics -->
  <h2 class="pilarease-itrc-subsection-title">3. Data Volume Metrics</h2>

  <!-- Masterlist Uploads Over Time -->
  <div class="pilarease-itrc-chart-container">
    <h3>Masterlist Uploads Over the Last 30 Days</h3>
    <canvas id="masterlistUploadsChart"></canvas>
  </div>

  <!-- User Feedback Analysis -->
  <h2 class="pilarease-itrc-subsection-title">4. User Feedback Analysis</h2>

  <!-- Sentiment Analysis -->
  <div class="pilarease-itrc-chart-container">
    <h3>User Feedback Sentiment Analysis</h3>
    <canvas id="feedbackSentimentChart"></canvas>
  </div>

  <!-- Top Feedback Keywords -->
  <div class="pilarease-itrc-chart-container">
    <h3>Top Feedback Keywords</h3>
    <canvas id="feedbackKeywordsChart"></canvas>
  </div>

  <!-- Audit Logs -->
  <h2 class="pilarease-itrc-subsection-title">5. Audit Logs</h2>

  <table class="pilarease-itrc-table">
    <thead>
      <tr>
        <th>User</th>
        <th>Action</th>
        <th>Details</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody>
      {% for log in audit_logs %}
      <tr>
        <td>{{ log.user.username }}</td>
        <td>{{ log.get_action_display }}</td>
        <td>{{ log.details }}</td>
        <td>{{ log.timestamp|date:"Y-m-d H:i" }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="pilarease-itrc-no-data">
          No audit logs available.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %} {% block extra_scripts %}
<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Login Activity Chart
  var loginActivityCtx = document.getElementById('loginActivityChart').getContext('2d');
  var loginActivityChart = new Chart(loginActivityCtx, {
    type: 'line',
    data: {
      labels: {{ login_activity_labels|safe }},
      datasets: [{
        label: 'Number of Logins',
        data: {{ login_activity_counts|safe }},
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1,
        fill: true,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: false,
          text: 'Login Activity'
        },
        legend: {
          display: true,
          position: 'top',
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Date'
          },
          ticks: {
            maxRotation: 90,
            minRotation: 45
          }
        },
        y: {
          title: {
            display: true,
            text: 'Number of Logins'
          },
          beginAtZero: true
        }
      }
    }
  });

  // Daily Active Users (DAU) Chart
  var dauCtx = document.getElementById('dauChart').getContext('2d');
  var dauChart = new Chart(dauCtx, {
    type: 'line',
    data: {
      labels: {{ dau_labels|safe }},
      datasets: [{
        label: 'Daily Active Users',
        data: {{ dau_counts|safe }},
        backgroundColor: 'rgba(255, 205, 86, 0.2)',
        borderColor: 'rgba(255, 205, 86, 1)',
        borderWidth: 1,
        fill: true,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: false,
          text: 'Daily Active Users'
        },
        legend: {
          display: true,
          position: 'top',
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Date'
          },
          ticks: {
            maxRotation: 90,
            minRotation: 45
          }
        },
        y: {
          title: {
            display: true,
            text: 'Number of Active Users'
          },
          beginAtZero: true
        }
      }
    }
  });

  // User Registration Chart
  var userRegistrationCtx = document.getElementById('userRegistrationChart').getContext('2d');
  var userRegistrationChart = new Chart(userRegistrationCtx, {
    type: 'line',
    data: {
      labels: {{ user_registration_labels|safe }},
      datasets: [{
        label: 'New Users',
        data: {{ user_registration_counts|safe }},
        backgroundColor: 'rgba(153, 102, 255, 0.2)',
        borderColor: 'rgba(153, 102, 255, 1)',
        borderWidth: 1,
        fill: true,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: false,
          text: 'User Registrations'
        },
        legend: {
          display: true,
          position: 'top',
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Date'
          },
          ticks: {
            maxRotation: 90,
            minRotation: 45
          }
        },
        y: {
          title: {
            display: true,
            text: 'Number of New Users'
          },
          beginAtZero: true
        }
      }
    }
  });

  // User Role Distribution Chart
  var userRoleCtx = document.getElementById('userRoleChart').getContext('2d');
  var userRoleChart = new Chart(userRoleCtx, {
    type: 'pie',
    data: {
      labels: {{ role_labels|safe }},
      datasets: [{
        data: {{ role_counts|safe }},
        backgroundColor: [
          '#FF6384', // ITRC Staff
          '#36A2EB', // Counselor
          '#FFCE56'  // User
        ],
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: false,
          text: 'User Role Distribution'
        }
      }
    }
  });

  // User Verification Status Chart
  var userVerificationCtx = document.getElementById('userVerificationChart').getContext('2d');
  var userVerificationChart = new Chart(userVerificationCtx, {
    type: 'doughnut',
    data: {
      labels: {{ verification_labels|safe }},
      datasets: [{
        data: {{ verification_counts|safe }},
        backgroundColor: [
          '#28a745', // Verified
          '#ffc107', // Pending
          '#dc3545'  // Rejected
        ],
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: false,
          text: 'User Verification Status'
        }
      }
    }
  });

  // Masterlist Uploads Chart
  var masterlistUploadsCtx = document.getElementById('masterlistUploadsChart').getContext('2d');
  var masterlistUploadsChart = new Chart(masterlistUploadsCtx, {
    type: 'bar',
    data: {
      labels: {{ masterlist_uploads_labels|safe }},
      datasets: [{
        label: 'Masterlist Uploads',
        data: {{ masterlist_uploads_counts|safe }},
        backgroundColor: 'rgba(255, 159, 64, 0.6)',
        borderColor: 'rgba(255, 159, 64, 1)',
        borderWidth: 1,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: false,
          text: 'Masterlist Uploads'
        },
        legend: {
          display: true,
          position: 'top',
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Date'
          },
          ticks: {
            maxRotation: 90,
            minRotation: 45
          }
        },
        y: {
          title: {
            display: true,
            text: 'Number of Uploads'
          },
          beginAtZero: true
        }
      }
    }
  });

  // Feedback Sentiment Chart
  var feedbackSentimentCtx = document.getElementById('feedbackSentimentChart').getContext('2d');
  var feedbackSentimentChart = new Chart(feedbackSentimentCtx, {
    type: 'pie',
    data: {
      labels: {{ sentiment_labels|safe }},
      datasets: [{
        data: {{ sentiment_counts|safe }},
        backgroundColor: [
          '#28a745', // Positive
          '#ffc107', // Neutral
          '#dc3545'  // Negative
        ],
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: false,
          text: 'User Feedback Sentiment Analysis'
        }
      }
    }
  });

  // Top Feedback Keywords Chart
  var feedbackKeywordsCtx = document.getElementById('feedbackKeywordsChart').getContext('2d');
  var feedbackKeywordsChart = new Chart(feedbackKeywordsCtx, {
    type: 'bar',
    data: {
      labels: {{ keywords|safe }},
      datasets: [{
        label: 'Keyword Frequency',
        data: {{ keyword_counts|safe }},
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1,
      }]
    },
    options: {
      indexAxis: 'y', // Makes the bar chart horizontal
      responsive: true,
      plugins: {
        legend: {
          display: false,
        },
        title: {
          display: false,
          text: 'Top Feedback Keywords'
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Frequency'
          },
          beginAtZero: true
        },
        y: {
          title: {
            display: true,
            text: 'Keywords'
          }
        }
      }
    }
  });
</script>
{% endblock %}
