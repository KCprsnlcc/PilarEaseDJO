{% extends "itrc_tools/base_itrc.html" %} {% block page_title %} Manage Users
{%endblock %} {% block itrc_content %}
<div
  class="pilarease-itrc-manage-users-container animate__animated animate__fadeIn"
>
  <h1 class="pilarease-itrc-section-title">Manage Users</h1>
  <p class="pilarease-itrc-section-info">
    View, edit, and manage user accounts within the system.
  </p>

  <form method="get" class="pilarease-itrc-search-form">
    <input
      type="text"
      name="search"
      placeholder="Search users..."
      class="pilarease-itrc-search-input"
      value="{{ search_query }}"
    />
    <button type="submit" class="pilarease-itrc-search-button">
      <i class="bx bx-search"></i>
    </button>
  </form>

  <table class="pilarease-itrc-table">
    <thead>
      <tr>
        <th>User ID</th>
        <th>Student ID</th>
        <th>Username</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.student_id }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.full_name }}</td>
        <td>{{ user.email }}</td>
        <td>
          {% if user.is_itrc_staff %} ITRC Staff {% elif user.is_counselor %}
          Counselor {% else %} User {% endif %}
        </td>
        <td>
          {% if user.is_verified %}
          <span class="pilarease-itrc-status-label verified">Verified</span>
          {% else %}
          <span class="pilarease-itrc-status-label pending">Pending</span>
          {% endif %}
        </td>
        <td>
          <!-- Action buttons (Edit, Activate, Deactivate, Delete) -->
          <button
            class="pilarease-itrc-action-button edit-button"
            data-user-id="{{ user.id }}"
            title="Edit User"
          >
            <i class="bx bxs-edit"></i>
          </button>

          <select
            class="pilarease-itrc-role-dropdown"
            data-user-id="{{ user.id }}"
          >
            <option
              value="user"
              {%
              if
              not
              user.is_itrc_staff
              and
              not
              user.is_counselor
              %}selected{%
              endif
              %}
            >
              User
            </option>
            <option
              value="counselor"
              {%
              if
              user.is_counselor
              %}selected{%
              endif
              %}
            >
              Counselor
            </option>
            <option
              value="itrc_staff"
              {%
              if
              user.is_itrc_staff
              %}selected{%
              endif
              %}
            >
              ITRC Staff
            </option>
          </select>

          {% if not user.is_verified %}
          <button
            class="pilarease-itrc-action-button activate-button"
            data-user-id="{{ user.id }}"
            title="Activate User"
          >
            <i class="bx bxs-check-circle"></i>
          </button>
          {% else %}
          <button
            class="pilarease-itrc-action-button deactivate-button"
            data-user-id="{{ user.id }}"
            title="Deactivate User"
          >
            <i class="bx bxs-x-circle"></i>
          </button>
          {% endif %}

          <button
            class="pilarease-itrc-action-button delete-button"
            data-user-id="{{ user.id }}"
            title="Delete User"
          >
            <i class="bx bxs-trash"></i>
          </button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8" class="pilarease-itrc-no-data">No users found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  <nav aria-label="Page navigation" class="pilarease-itrc-pagination">
    <ul class="pagination justify-content-center">
      <!-- Previous Page Link -->
      {% if logs.has_previous %}
      <li class="page-item">
        <a
          class="page-link"
          href="?page={{ logs.previous_page_number }}&search={{ search_query }}"
        >
          &laquo;
        </a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">&laquo;</span>
      </li>
      {% endif %}

      <!-- Page Number Links -->
      {% for num in logs_page_range %} {% if num == logs.number %}
      <li class="page-item active"><span class="page-link">{{ num }}</span></li>
      {% else %}
      <li class="page-item">
        <a class="page-link" href="?page={{ num }}&search={{ search_query }}">
          {{ num }}
        </a>
      </li>
      {% endif %} {% endfor %}

      <!-- Next Page Link -->
      {% if logs.has_next %}
      <li class="page-item">
        <a
          class="page-link"
          href="?page={{ logs.next_page_number }}&search={{ search_query }}"
        >
          &raquo;
        </a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">&raquo;</span>
      </li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
