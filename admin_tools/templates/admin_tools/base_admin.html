{% load static compress %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin | PilarEase</title>
    <link rel="icon" href="{% static 'images/Icons/PilarEaseLogo.ico' %}" />
    {% compress css %}
    <link rel="stylesheet" href="{% static 'css/admin.css' %}" />
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}" />
    {% endcompress %}
    <!-- Include daterangepicker CSS from CDN -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Aguafina+Script&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Gothic+A1&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Inter&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Epilogue&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/cropperjs/dist/cropper.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div
      class="pilarease-admin-sidebar sidebar animate__animated animate__fadeInLeft"
    >
      <div class="pilarease-admin-sidebar-header sidebar-header">
        <img
          src="{% static 'images/PilarLogo.png' %}"
          alt="Logo"
          class="pilarease-admin-sidebar-logo sidebar-logo"
        />
        <img
          src="{% static 'images/PilarEaseLogo.png' %}"
          alt="Additional Logo"
          class="pilarease-admin-sidebar-additional-logo sidebar-additional-logo"
        />
        <span class="pilarease-admin-sidebar-title sidebar-title"
          >PilarEase</span
        >
      </div>
      <ul class="pilarease-admin-sidebar-menu sidebar-menu">
        <li>
          <a href="{% url 'dashboard' %}">
            <i class="bx bx-home"></i>
            <span class="pilarease-admin-menu-text menu-text">Dashboard</span>
          </a>
        </li>
        <li>
          <a href="{% url 'statistics' %}">
            <i class="bx bx-bar-chart"></i>
            <span class="pilarease-admin-menu-text menu-text">Statistics</span>
          </a>
        </li>
        <li>
          <a href="{% url 'analysis' %}">
            <i class="bx bx-line-chart"></i>
            <span class="pilarease-admin-menu-text menu-text">Analysis</span>
          </a>
        </li>
<li>
  <a href="{% url 'insights_dashboard' %}">
    <i class="bx bx-bulb"></i>
    <span class="pilarease-admin-menu-text menu-text">Insights</span>
  </a>
</li>

        <li>
          <a href="{% url 'comparison' %}">
            <i class="bx bx-merge"></i>
            <span class="pilarease-admin-menu-text menu-text">Comparison</span>
          </a>
        </li>
        <li>
          <a href="{% url 'performance_dashboard' %}">
            <i class="bx bx-chart"></i>
            <span class="pilarease-admin-menu-text menu-text">Performance</span>
          </a>
        </li>
        <li>
          <a href="{% url 'appointment:dashboard' %}">
            <i class="bx bx-calendar"></i>
            <span class="pilarease-admin-menu-text menu-text">Appointment</span>
          </a>
        </li>
        <li>
          <a href="{% url 'contact' %}">
            <i class="bx bxs-contact"></i>
            <span class="pilarease-admin-menu-text menu-text">Contact</span>
          </a>
        </li>
        <li>
          <a href="{% url 'feedback' %}">
            <i class="bx bx-message-square-detail"></i>
            <span class="pilarease-admin-menu-text menu-text">Feedback</span>
          </a>
        </li>
        <li>
          <a href="{% url 'replies' %}">
            <i class="bx bx-message"></i>
            <span class="pilarease-admin-menu-text menu-text">Replies</span>
          </a>
        </li>
        <li>
          <a href="{% url 'chat' %}">
            <i class="bx bx-chat"></i>
            <span class="pilarease-admin-menu-text menu-text">Chat</span>
          </a>
        </li>
        <li>
          <a href="{% url 'manage_referrals' %}">
            <i class="bx bx-receipt"></i>
            <span class="pilarease-admin-menu-text menu-text">Referral</span>
          </a>
        </li>
        <li>
          <a href="{% url 'manage_profanities' %}">
            <i class="bx bx-badge-check"></i>
            <span class="pilarease-admin-menu-text menu-text">Profanity</span>
          </a>
        </li>
        <li>
          <a href="{% url 'admin_data' %}">
            <i class="bx bx-data"></i>
            <span class="pilarease-admin-menu-text menu-text">Data</span>
          </a>
        </li>
        <li>
          <a href="{% url 'admin_logout' %}">
            <i class="bx bx-log-out"></i>
            <span class="pilarease-admin-menu-text menu-text">Logout</span>
          </a>
        </li>
      </ul>
      <div class="pilarease-admin-sidebar-toggle">
        <button id="sidebarToggleBtn" class="pilarease-admin-sidebar-toggle-button">
          <i class="bx bx-chevron-right"></i>
        </button>
      </div>
    </div>
    <div class="pilarease-admin-main-content main-content">
      <!-- Header -->
      <div class="pilarease-admin-header header">
        <div class="pilarease-admin-header-right header-right">
          <!-- Notification Button -->
          <button
            id="pilareaseAdminNotificationButton"
            class="pilarease-admin-notification-button"
          >
            <i class="bx bxs-bell"></i>
            <span
              id="pilareaseAdminNotificationDot"
              class="pilarease-admin-notification-dot"
            ></span>
          </button>

          <!-- Notification List -->
          <div
            id="pilareaseAdminNotificationList"
            class="pilarease-admin-notification-list"
            style="display: none"
          >
            <!-- Notification List Header -->
            <div class="pilarease-admin-notification-header">
              <span class="pilarease-admin-earlier">Notifications</span>
              <span class="pilarease-admin-see-all">See All</span>
            </div>

            <!-- Notifications will be dynamically added here -->
            <div id="pilareaseAdminNotificationItems"></div>

            <!-- Load More Button Only -->
            <div
              id="pilareaseAdminNotificationLoadMore"
              class="pilarease-admin-notification-load-more"
              style="display: none"
            >
              Load More
            </div>
          </div>

          <!-- Profile Icon with Capitalized Initial -->
          <div class="pilarease-admin-profile-icon profile-icon">
            {{ request.user.full_name|default:"M"|slice:":1"|capfirst }}
          </div>
        </div>
      </div>
      <div class="pilarease-admin-content content">
        {% block content %} {% endblock %}
      </div>
    </div>
    {% compress js %}
    <script src="{% static 'js/notifications.js' %}?v=1.0"></script>
    {% endcompress %}
    <!-- Include jQuery from CDN -->
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-3.6.0.min.js"
    ></script>

    <!-- Include Moment.js from CDN -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"
    ></script>

    <!-- Include daterangepicker JS from CDN -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"
    ></script>
    <script>
      const sidebar = document.querySelector(".pilarease-admin-sidebar");
      const sidebarToggleBtn = document.getElementById("sidebarToggleBtn");
      const sidebarToggleIcon = sidebarToggleBtn.querySelector("i");
      
      // Function to toggle sidebar
      function toggleSidebar() {
        sidebar.classList.toggle("pilarease-admin-sidebar-expanded");
        
        // Change button icon based on sidebar state
        if (sidebar.classList.contains("pilarease-admin-sidebar-expanded")) {
          sidebarToggleIcon.classList.remove("bx-chevron-right");
          sidebarToggleIcon.classList.add("bx-chevron-left");
        } else {
          sidebarToggleIcon.classList.remove("bx-chevron-left");
          sidebarToggleIcon.classList.add("bx-chevron-right");
        }
        
        // Save sidebar state to localStorage
        localStorage.setItem("sidebarExpanded", sidebar.classList.contains("pilarease-admin-sidebar-expanded"));
      }
      
      // Initialize sidebar state from localStorage
      document.addEventListener("DOMContentLoaded", function() {
        const savedState = localStorage.getItem("sidebarExpanded");
        
        // If there's a saved state, apply it
        if (savedState === "true") {
          sidebar.classList.add("pilarease-admin-sidebar-expanded");
          sidebarToggleIcon.classList.remove("bx-chevron-right");
          sidebarToggleIcon.classList.add("bx-chevron-left");
        } else {
          sidebar.classList.remove("pilarease-admin-sidebar-expanded");
          sidebarToggleIcon.classList.remove("bx-chevron-left");
          sidebarToggleIcon.classList.add("bx-chevron-right");
        }
        
        // Set active page in the sidebar based on URL path
        const currentPath = window.location.pathname;
        
        // Map URL patterns to their respective menu items using text content
        const menuMap = {
          '/dashboard': 'Dashboard',
          '/statistics': 'Statistics',
          '/analysis': 'Analysis',
          '/insights': 'Insights',
          '/comparison': 'Comparison',
          '/performance': 'Performance',
          '/appointment': 'Appointment',
          '/contact': 'Contact',
          '/feedback': 'Feedback',
          '/replies': 'Replies',
          '/chat': 'Chat',
          '/referrals': 'Referral',
          '/profanities': 'Profanity',
          '/data': 'Data',
          '/logout': 'Logout'
        };
        
        // Find matching menu item and add active class
        Object.keys(menuMap).forEach(key => {
          if (currentPath.includes(key)) {
            const menuItems = document.querySelectorAll('.pilarease-admin-sidebar-menu li a');
            menuItems.forEach(item => {
              const menuText = item.querySelector('.pilarease-admin-menu-text');
              if (menuText && menuText.textContent === menuMap[key]) {
                item.classList.add('active');
              }
            });
          }
        });
      });
      
      // Toggle sidebar when button is clicked
      sidebarToggleBtn.addEventListener("click", toggleSidebar);
      
      // Remove hover event listeners to prevent auto-expanding
      /*
      sidebar.addEventListener("mouseenter", () => {
        sidebar.classList.add("pilarease-admin-sidebar-expanded");
      });
      sidebar.addEventListener("mouseleave", () => {
        sidebar.classList.remove("pilarease-admin-sidebar-expanded");
      });
      */

      // Modal Handling
      const modals = document.querySelectorAll(".pilarease-admin-modal");
      const closeButtons = document.querySelectorAll(".pilarease-admin-close");

      closeButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const modal = btn.closest(".pilarease-admin-modal");
          modal.style.display = "none";
        });
      });

      window.onclick = function (event) {
        modals.forEach((modal) => {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        });
      };
    </script>
  </body>
</html>
