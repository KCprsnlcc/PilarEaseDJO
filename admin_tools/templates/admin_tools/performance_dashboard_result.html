<!-- admin_tools/templates/admin_tools/performance_dashboard_result.html -->
{% extends "admin_tools/base_admin.html" %} {% load static %} {%block content%}
<div class="pilarease-admin-performance-dashboard-container">
  <h2 class="pilarease-admin-section-title">
    Performance Metrics
    <i class="bx bx-info-circle pilarease-admin-info-icon"></i>
    <div class="pilarease-admin-tooltip">
      Here are the calculated performance metrics based on your uploaded
      dataset.
    </div>
  </h2>

  <!-- Display Messages -->
  {% if messages %}
  <ul class="pilarease-admin-messages">
    {% for message in messages %}
    <li class="pilarease-admin-message {{ message.tags }}">{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %}

  <div class="pilarease-admin-metrics-section">
    <h3>Overall Metrics</h3>
    <ul class="pilarease-admin-metrics-list">
      <li><strong>Accuracy:</strong> {{ performance_result.accuracy }}%</li>
      <li><strong>Precision:</strong> {{ performance_result.precision }}%</li>
      <li><strong>Recall:</strong> {{ performance_result.recall }}%</li>
      <li><strong>F1 Score:</strong> {{ performance_result.f1_score }}%</li>
    </ul>
  </div>

  <div class="pilarease-admin-confusion-matrix-section">
    <h3>Confusion Matrix</h3>
    <img
      src="data:image/png;base64,{{ performance_result.confusion_matrix_image }}"
      alt="Confusion Matrix"
      class="pilarease-admin-confusion-matrix-image animate__animated animate__fadeIn"
    />
  </div>

  <div class="pilarease-admin-classification-report-section">
    <h3>Classification Report</h3>
    <div
      class="pilarease-admin-classification-report-table-container animate__animated animate__fadeIn"
    >
      {{ performance_result.classification_report_html|safe }}
    </div>
    <!-- Download Button -->
    <a
      href="data:text/csv;base64,{{ performance_result.classification_report_csv }}"
      download="classification_report.csv"
      class="pilarease-admin-action-button download-report-button"
    >
      <i class="bx bxs-download"></i> Download Report
    </a>
  </div>

  <!-- Processed Dataset Section -->
  <div class="pilarease-admin-processed-dataset-section">
    <h3>Processed Dataset</h3>

    <!-- Search Form -->
    <form method="get" class="pilarease-admin-filter-form">
      <input
        type="hidden"
        name="dataset_id"
        value="{{ performance_result.dataset.id }}"
      />
      <div class="pilarease-admin-filter-group">
        <label for="search" class="pilarease-admin-filter-label">Search:</label>
        <input
          type="text"
          name="search"
          id="search"
          class="pilarease-admin-filter-input"
          placeholder="Search..."
          value="{{ search_query }}"
        />
      </div>
      <button type="submit" class="pilarease-admin-filter-button">
        Search
      </button>
      <a
        href="{% url 'performance_dashboard_result' %}?dataset_id={{ performance_result.dataset.id }}"
        class="pilarease-admin-action-button pilarease-admin-reset-button"
        >Reset</a
      >
    </form>

    <!-- Data Table -->
    {% if page_obj and page_obj.object_list %}
    <table class="pilarease-admin-feedback-table">
      <thead>
        <tr>
          <th>Text</th>
          <th>Label</th>
          <th>Predicted Label</th>
        </tr>
      </thead>
      <tbody>
        {% for row in page_obj.object_list %}
        <tr>
          <td>{{ row.Text }}</td>
          <td>{{ row.Label }}</td>
          <td>{{ row.Predicted_Label }}</td>
          <!-- or adjust according to your model -->
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="pilarease-admin-pagination">
      <div class="pilarease-admin-step-links">
        {% if page_obj.has_previous %}
        <a
          href="?dataset_id={{ performance_result.dataset.id }}&search={{ search_query }}&page=1"
          >&laquo; First</a
        >
        <a
          href="?dataset_id={{ performance_result.dataset.id }}&search={{ search_query }}&page={{ page_obj.previous_page_number }}"
          >&lsaquo; Previous</a
        >
        {% endif %}

        <span class="pilarease-admin-current"
          >Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages
          }}</span
        >

        {% if page_obj.has_next %}
        <a
          href="?dataset_id={{ performance_result.dataset.id }}&search={{ search_query }}&page={{ page_obj.next_page_number }}"
          >Next &rsaquo;</a
        >
        <a
          href="?dataset_id={{ performance_result.dataset.id }}&search={{ search_query }}&page={{ page_obj.paginator.num_pages }}"
          >Last &raquo;</a
        >
        {% endif %}
      </div>
    </div>
    {% else %}
    <p class="pilarease-admin-no-feedback">
      No data available for the current search criteria.
    </p>
    {% endif %}

    <!-- Download Processed Dataset -->
    {% if performance_result.processed_csv_file %}
    <a
      href="{{ performance_result.processed_csv_file.url }}"
      download="processed_dataset_{{ performance_result.dataset.id }}.csv"
      class="pilarease-admin-action-button download-report-button"
    >
      <i class="bx bxs-download"></i> Download Processed Dataset
    </a>
    {% endif %}
  </div>

  <!-- Link to Upload Another Dataset -->
  <div class="pilarease-admin-upload-another">
    <a
      href="{% url 'performance_dashboard' %}"
      class="pilarease-admin-action-button upload-another-button"
    >
      <i class="bx bx-upload"></i> Upload Another Dataset
    </a>
  </div>
</div>
{% endblock %}
