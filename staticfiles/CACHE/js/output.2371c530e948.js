document.getElementById("resetPasswordForm").addEventListener("submit",function(event){event.preventDefault();const newPassword=document.querySelector('input[name="new_password"]').value;const confirmPassword=document.querySelector('input[name="new_password_confirm"]').value;const submitButton=document.querySelector(".btn");const csrfToken=document.querySelector("[name=csrfmiddlewaretoken]").value;if(newPassword!==confirmPassword){resetPasswordErrorBox("Passwords do not match.");return;}
const passwordStrengthRegex=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;if(!passwordStrengthRegex.test(newPassword)){resetPasswordErrorBox("Password must be at least 8 characters long, contain both uppercase and lowercase letters, include at least one numeric digit, and one special character.");return;}
showResetPassLoader();submitButton.disabled=true;fetch(window.location.href,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRFToken":csrfToken,},body:new URLSearchParams({new_password:newPassword,new_password_confirm:confirmPassword,}),}).then((response)=>response.json()).then((data)=>{hideResetPassLoader();if(data.success){resetPasswordSuccessBox("Your password has been successfully reset.");}else{resetPasswordErrorBox(data.error||"An error occurred. Please try again later.");}
setTimeout(()=>{submitButton.disabled=false;},3600);}).catch((error)=>{hideResetPassLoader();console.error("Error:",error);resetPasswordErrorBox("An error occurred. Please try again later.");setTimeout(()=>{submitButton.disabled=false;},3600);});});function showResetPassLoader(){document.getElementById("resetpassOverlay").style.display="block";}
function hideResetPassLoader(){document.getElementById("resetpassOverlay").style.display="none";}
function resetPasswordSuccessBox(message){const successBox=document.getElementById("resetPasswordSuccessBox");document.getElementById("resetPasswordSuccessContent").innerText=message;successBox.classList.remove("pop-out");successBox.classList.add("pop-in");successBox.style.display="block";setTimeout(()=>{successBox.classList.remove("pop-in");successBox.classList.add("pop-out");setTimeout(()=>{successBox.style.display="none";successBox.classList.remove("pop-in","pop-out");window.location.href="/login/";},300);},3000);}
function resetPasswordErrorBox(error){const errorBox=document.getElementById("resetPasswordErrorBox");document.getElementById("resetPasswordErrorContent").innerText=error;errorBox.classList.remove("pop-out");errorBox.classList.add("pop-in");errorBox.style.display="block";setTimeout(()=>{errorBox.classList.remove("pop-in");errorBox.classList.add("pop-out");setTimeout(()=>{errorBox.style.display="none";errorBox.classList.remove("pop-in","pop-out");},300);},3000);};